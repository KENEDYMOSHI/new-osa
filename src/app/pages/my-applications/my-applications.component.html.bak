<div class="p-6 bg-gray-50 min-h-screen font-sans">
  
  <!-- Header -->
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-xl font-bold text-gray-700">My Applications</h1>
    <button routerLink="/Initial-Application" class="bg-[#F59E0B] hover:bg-[#D97706] text-white font-medium py-2 px-6 rounded-full shadow-sm transition-colors flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
      </svg>
      New Application
    </button>
  </div>

  <!-- Filter Section -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden border-t-4 border-t-[#e79a3f] mb-8">
    <div class="bg-orange-50 px-6 py-4 border-b border-orange-100">
      <h2 class="text-lg font-bold text-gray-800">Filter Applications</h2>
    </div>
    
    <div class="p-6">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <!-- License Category -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-2">License Category</label>
          <div class="relative">
            <select [(ngModel)]="selectedCategory" class="w-full appearance-none bg-white border border-gray-300 text-gray-700 py-2.5 px-4 pr-8 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent">
              <option>All Categories</option>
              <option>Class A</option>
              <option>Class B</option>
            </select>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
              <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
            </div>
          </div>
        </div>

        <!-- Status -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-2">Status</label>
          <div class="relative">
            <select [(ngModel)]="selectedStatus" class="w-full appearance-none bg-white border border-gray-300 text-gray-700 py-2.5 px-4 pr-8 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent">
              <option>All Statuses</option>
              <option>Returned</option>
              <option>Approved</option>
              <option>Pending</option>
            </select>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
              <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
            </div>
          </div>
        </div>

        <!-- Application Date -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-2">Application Date</label>
          <div class="relative">
            <input type="date" [(ngModel)]="selectedDate" class="w-full bg-white border border-gray-300 text-gray-700 py-2.5 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent placeholder-gray-400" placeholder="From this date">
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-3">
        <button class="px-6 py-2 border border-orange-300 text-orange-500 font-medium rounded-full hover:bg-orange-50 transition-colors flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
          </svg>
          Reset
        </button>
        <button class="px-6 py-2 bg-[#F59E0B] hover:bg-[#D97706] text-white font-medium rounded-full shadow-sm transition-colors flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
          </svg>
          Search
        </button>
      </div>
    </div>
  </div>

  <!-- Approved Applications -->
  <div *ngIf="approvedApplications.length > 0" class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden border-t-4 border-t-green-500 mb-8">
    <div class="bg-green-50 px-6 py-4 border-b border-green-100">
      <h2 class="text-lg font-bold text-gray-800">My Approved Applications</h2>
      <p class="text-sm text-gray-500">View your approved license applications</p>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full text-sm text-center text-gray-600">
            <thead class="text-xs text-center text-gray-700 uppercase bg-gray-50 border-b border-gray-200">
                <tr>
                    <th class="px-6 py-3 font-semibold tracking-wider">License Type</th>
                    <th class="px-6 py-3 font-semibold tracking-wider">License No</th>
                    <th class="px-6 py-3 font-semibold tracking-wider">Issue Date</th>
                    <th class="px-6 py-3 font-semibold tracking-wider">Expiry Date</th>
                    <th class="px-6 py-3 font-semibold tracking-wider text-center">Action</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                <tr *ngFor="let app of approvedApplications" class="bg-white hover:bg-green-50/30 transition-colors">
                    <td class="px-6 py-4 font-bold text-gray-800">{{ app.licenseClass }}</td>
                    <td class="px-6 py-4 font-mono text-xs">{{ app.control_number || 'Pending' }}</td>
                    <td class="px-6 py-4">{{ app.date }}</td>
                    <td class="px-6 py-4 text-gray-400 font-medium">Dec 26, 2026</td> <!-- Mocked for now as per screenshot -->
                    <td class="px-6 py-4 text-center">
                        <button (click)="viewApplicationDetails(app)" class="text-blue-500 hover:text-blue-700 bg-blue-50 hover:bg-blue-100 p-2 rounded-full transition-all active:scale-95 shadow-sm" title="View Details">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
  </div>

  <!-- Applications List (In Progress) -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden border-t-4 border-t-[#e79a3f]">
    <div class="bg-orange-50 px-6 py-4 border-b border-orange-100">
      <h2 class="text-lg font-bold text-gray-800">In Progress Applications</h2>
    </div>

    <div class="p-6 space-y-6">
      <div *ngIf="loading" class="text-center py-8 text-gray-500">Loading applications...</div>
      <div *ngIf="!loading && inProgressApplications.length === 0" class="text-center py-8 text-gray-500">No active applications found.</div>
      
      <!-- Application Card -->
      <div *ngFor="let app of inProgressApplications" class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow">
        <div class="flex flex-col lg:flex-row">
          
          <!-- Left Info Section -->
          <div class="p-4 lg:w-1/3 border-b lg:border-b-0 lg:border-r border-gray-100 bg-gray-50/50">
            <div class="flex items-start gap-3 mb-4">
              <div class="bg-orange-100 p-2.5 rounded-xl text-orange-500 shadow-sm shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                </svg>
              </div>
              <div class="flex-1 min-w-0">
                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Control Number</span>
                <h3 class="text-base font-bold text-gray-800 tracking-tight leading-tight truncate">{{ app.id }}</h3>
                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-medium mt-1" [ngClass]="app.statusColor || 'bg-gray-100 text-gray-600'">
                  {{ app.status }}
                </span>
              </div>
            </div>

            <div class="space-y-2">
              <div class="grid grid-cols-[80px_1fr] gap-2 text-xs">
                <span class="text-gray-500 font-medium">License:</span>
                <span class="font-semibold text-gray-800 text-right truncate">{{ app.licenseClass }}</span>
              </div>
              <div class="grid grid-cols-[80px_1fr] gap-2 text-xs">
                <span class="text-gray-500 font-medium">Date:</span>
                <span class="font-semibold text-gray-800 text-right">{{ app.date }}</span>
              </div>
              <div class="grid grid-cols-[80px_1fr] gap-2 text-xs">
                <span class="text-gray-500 font-medium">License Fee:</span>
                <span class="font-bold text-gray-800 text-right">TZS {{ app.licenseFee | number:'1.2-2' }}</span>
              </div>
              <div class="grid grid-cols-[80px_1fr] gap-2 text-xs">
                <span class="text-gray-500 font-medium">App. Fee:</span>
                <span class="font-bold text-gray-800 text-right">TZS {{ app.applicationFeeText || (app.applicationFee | number:'1.2-2') }}</span>
              </div>
            </div>
          </div>

          <!-- Right Journey Section -->
          <div class="p-4 lg:w-2/3 flex flex-col justify-between">
            
            <div class="flex justify-between items-center mb-6">
              <h3 class="font-bold text-gray-700 text-sm">License Approval Journey</h3>
              <div class="flex gap-3 text-[10px] text-gray-500 font-medium">
                <div class="flex items-center gap-1">
                  <span class="w-2 h-2 rounded-full bg-green-500 ring-1 ring-green-100"></span> Approved
                </div>
                <div class="flex items-center gap-1">
                  <span class="w-2 h-2 rounded-full border border-orange-500"></span> In Review
                </div>
                <div class="flex items-center gap-1">
                  <span class="w-2 h-2 rounded-full bg-gray-200"></span> Waiting
                </div>
              </div>
            </div>

            <!-- Stepper & Action -->
            <div class="flex items-center justify-between mb-6">
              
              <!-- Stepper -->
              <div class="relative flex-1 mr-6">
                <!-- Connecting Line -->
                <div class="absolute top-3 left-0 w-full h-0.5 bg-gray-100 -z-10"></div>
                
                <div class="flex justify-between">
                  <div *ngFor="let step of app.steps; let i = index" class="flex flex-col items-center text-center w-1/4 group cursor-default relative">
                    
                    <div class="w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold mb-1.5 z-10 transition-all duration-300 border-2 shadow-sm"
                         [ngClass]="{
                           'bg-[#F59E0B] border-[#F59E0B] text-white scale-110': step.status === 'completed',
                           'bg-white border-[#F59E0B] text-[#F59E0B] scale-110 ring-2 ring-orange-50': step.status === 'current',
                           'bg-white border-gray-200 text-gray-400': step.status === 'pending'
                         }">
                      <ng-container *ngIf="step.status === 'completed'; else numberTemplate">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3">
                          <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
                        </svg>
                      </ng-container>
                      <ng-template #numberTemplate>{{ step.number }}</ng-template>
                    </div>

                    <div class="text-[10px] font-bold text-gray-800 leading-none mb-0.5">{{ step.title }}</div>
                    <div class="text-[9px] text-gray-500 leading-tight hidden sm:block">{{ step.subtitle }}</div>
                    
                    <!-- Current Step Indicator (Spinning Icon) -->
                    <div *ngIf="step.status === 'current'" class="absolute -top-1.5 -right-1.5 text-orange-500 animate-spin-slow bg-white rounded-full">
                       <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>

              <!-- License Fee Workflow Buttons -->
              <div class="flex items-center shrink-0 gap-2">
                  <!-- Complete Application Action -->
                  <button *ngIf="app.canFillLicenseApp" 
                          routerLink="/license-application" 
                          [queryParams]="{ appId: app.id }"
                          class="bg-[#F59E0B] hover:bg-[#D97706] text-white font-bold py-2 px-3 rounded-md shadow-sm transition-all flex items-center gap-1.5 text-[10px] whitespace-nowrap animate-pulse">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                    </svg>
                    Complete License Application
                  </button>

                  <!-- Generate Fee Button (shown when approved but no bill) -->
                  <button *ngIf="(app.status === 'Approved' || app.status === 'Approved_CEO') && !app.bill_status"
                          (click)="generateFee(app)"
                          class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-3 rounded-md shadow-sm transition-all flex items-center gap-1.5 text-[10px] whitespace-nowrap">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                    </svg>
                    Generate Fee
                  </button>

                  <!-- View Bill Button (shown when bill exists but not paid) -->
                  <button *ngIf="app.bill_status === 'Pending'"
                          (click)="viewBill(app)"
                          class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-3 rounded-md shadow-sm transition-all flex items-center gap-1.5 text-[10px] whitespace-nowrap">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                    </svg>
                    View Bill
                  </button>

                  <!-- View License Button (shown only when payment is completed) -->
                  <button *ngIf="app.bill_status === 'Paid'"
                          (click)="viewLicense(app)"
                          class="bg-[#F59E0B] hover:bg-[#D97706] text-white font-bold py-2 px-3 rounded-md shadow-sm transition-all flex items-center gap-1.5 text-[10px] whitespace-nowrap">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                    </svg>
                    View License
                  </button>
              </div>

            </div>
            
            <!-- Interview Result Indicator (shown after Surveillance approval) -->
            <div *ngIf="app.steps.length === 2 && app.interview?.result" class="mb-4 flex items-center justify-center">
              <div class="flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium"
                   [ngClass]="{
                     'bg-green-50 text-green-700 border border-green-200': app.interview.result === 'PASS',
                     'bg-red-50 text-red-700 border border-red-200': app.interview.result === 'FAIL',
                     'bg-yellow-50 text-yellow-700 border border-yellow-200': app.interview.result === 'Pending'
                   }">
                <svg *ngIf="app.interview.result === 'PASS'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                </svg>
                <svg *ngIf="app.interview.result === 'FAIL'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
                </svg>
                <svg *ngIf="app.interview.result === 'Pending'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z" clip-rule="evenodd" />
                </svg>
                <span *ngIf="app.interview.result === 'PASS'">Interview Passed - Advanced stages unlocked</span>
                <span *ngIf="app.interview.result === 'FAIL'">Interview Failed - Approval process stopped</span>
                <span *ngIf="app.interview.result === 'Pending'">Awaiting Interview Results</span>
              </div>
            </div>

            <div class="space-y-3">
                <!-- Progress Bar -->
                <div class="flex items-center gap-3">
                  <div class="flex-1">
                    <div class="w-full bg-gray-100 rounded-full h-1.5">
                      <div class="bg-[#F59E0B] h-1.5 rounded-full transition-all duration-1000" [style.width.%]="app.progress"></div>
                    </div>
                  </div>
                  <div class="text-[10px] font-semibold text-gray-500 whitespace-nowrap bg-gray-100 px-1.5 py-0.5 rounded">{{ app.progress }}%</div>
                </div>

                <!-- Interview Result Section - COMPACT -->
                <div class="mt-3 p-3 bg-orange-50/50 border border-orange-100 rounded-lg group hover:border-orange-200 transition-colors relative">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="p-1.5 bg-white rounded border border-orange-100 text-orange-500">
                                 <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
                                </svg>
                            </div>
                            <div>
                                 <h4 class="text-[10px] font-bold text-gray-400 uppercase tracking-wide leading-none mb-0.5">Interview Result</h4>
                                 <div *ngIf="app.interview?.result && app.interview?.result !== 'Pending'; else pendingResult">
                                    <span class="text-sm font-black tracking-tight leading-none"
                                        [ngClass]="{
                                        'text-green-600': app.interview?.result === 'PASS',
                                        'text-red-600': app.interview?.result === 'FAIL'
                                        }">
                                    {{ app.interview?.result }}
                                    </span>
                                 </div>
                                 <ng-template #pendingResult>
                                     <span class="text-[10px] font-bold text-gray-400 italic">Pending Release</span>
                                 </ng-template>
                            </div>
                        </div>

                        <!-- View Result Button -->
                        <button (click)="toggleInterviewResult(app.interview)"
                                [disabled]="!app.interview?.result || app.interview?.result === 'Pending'"
                                [ngClass]="{
                                    'opacity-50 cursor-not-allowed text-gray-400 border-gray-200': !app.interview?.result || app.interview?.result === 'Pending',
                                    'text-white bg-[#F59E0B] hover:bg-[#D97706] shadow-sm border-transparent': app.interview?.result && app.interview?.result !== 'Pending'
                                }"
                                class="text-[10px] font-bold border px-3 py-1.5 rounded-md transition-all flex items-center gap-1.5 active:scale-95">
                          <span>View Result</span>
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                          </svg>
                        </button>
                    </div>

                    <!-- Popover Result (Only Scores) -->
                    <div *ngIf="selectedInterview === app.interview" 
                         class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-56 bg-white rounded-lg shadow-xl border border-gray-200 z-50 animate-[fade-in_0.2s_ease-out]">
                        <!-- Header -->
                        <div class="px-3 py-2 border-b border-gray-100 bg-gradient-to-r from-orange-50 to-orange-100/50 rounded-t-lg flex justify-between items-center">
                            <h4 class="text-[9px] font-bold text-gray-700 uppercase tracking-widest">Interview Result</h4>
                            <button (click)="toggleInterviewResult(app.interview)" class="text-gray-500 hover:text-gray-700 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        </div>

                        <!-- Scores Grid -->
                        <div class="p-3 grid grid-cols-3 gap-2">
                            <div class="text-center">
                                <div class="text-lg font-bold text-gray-800 mb-0.5">{{ app.interview.theory | number:'1.0-0' }}</div>
                                <div class="text-[8px] font-bold text-gray-400 uppercase tracking-wide">Theory</div>
                            </div>
                            <div class="text-center border-l border-gray-200">
                                <div class="text-lg font-bold text-gray-800 mb-0.5">{{ app.interview.practical | number:'1.0-0' }}</div>
                                <div class="text-[8px] font-bold text-gray-400 uppercase tracking-wide">Practical</div>
                            </div>
                            <div class="text-center border-l border-gray-200">
                                <div class="text-lg font-bold mb-0.5"
                                     [ngClass]="{
                                        'text-green-600': app.interview?.result === 'PASS',
                                        'text-red-600': app.interview?.result === 'FAIL'
                                     }">{{ app.interview.total | number:'1.0-0' }}</div>
                                <div class="text-[8px] font-bold text-orange-500 uppercase tracking-wide">Total Mark</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Pagination -->
  <div class="flex justify-end items-center gap-4 mt-8 text-sm text-gray-600">
    <span>Items per page:</span>
    <select class="bg-white border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-orange-500">
      <option>1</option>
      <option>5</option>
      <option>10</option>
    </select>
    <span>1 – 1 of 1</span>
    <div class="flex gap-1">
      <button class="p-1 rounded hover:bg-gray-100 disabled:opacity-50" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
        </svg>
      </button>
      <button class="p-1 rounded hover:bg-gray-100 disabled:opacity-50" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Fee Generation Success Modal -->
  <div *ngIf="showFeeModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden animate-[fade-in_0.3s_ease-out]">
      <!-- Header -->
      <div class="bg-gradient-to-r from-green-500 to-green-600 px-6 py-4 text-white">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="bg-white bg-opacity-20 p-2 rounded-full">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
              </svg>
            </div>
            <h3 class="text-xl font-bold">Fee Generated Successfully!</h3>
          </div>
          <button (click)="closeFeeModal()" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-1 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Body -->
      <div class="p-6 space-y-4">
        <!-- Control Number -->
        <div class="bg-orange-50 border-2 border-orange-200 rounded-xl p-4">
          <div class="text-xs font-bold text-orange-600 uppercase tracking-wider mb-1">Control Number</div>
          <div class="text-2xl font-black text-orange-700 tracking-tight">{{ feeModalData?.control_number }}</div>
        </div>

        <!-- Fee Details -->
        <div class="space-y-3">
          <div class="flex justify-between items-center pb-2 border-b border-gray-200">
            <span class="text-sm text-gray-600">License Fee</span>
            <span class="text-base font-bold text-gray-800">TZS {{ formatNumber(feeModalData?.license_fee) }}</span>
          </div>
          <div class="flex justify-between items-center pb-2 border-b border-gray-200">
            <span class="text-sm text-gray-600">Application Fee</span>
            <span class="text-base font-bold text-gray-800">TZS {{ formatNumber(feeModalData?.application_fee) }}</span>
          </div>
          <div class="flex justify-between items-center pt-2 bg-gray-50 -mx-6 px-6 py-3 rounded-lg">
            <span class="text-base font-bold text-gray-700">Total Amount</span>
            <span class="text-xl font-black text-[#F59E0B]">TZS {{ formatNumber(feeModalData?.total_amount) }}</span>
          </div>
        </div>

        <!-- Info Message -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 flex gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-blue-500 shrink-0 mt-0.5">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z" clip-rule="evenodd" />
          </svg>
          <div class="text-sm text-blue-800">
            <p class="font-semibold mb-1">Next Steps:</p>
            <p>You can view and pay this bill in the <span class="font-bold">"Billing & Payments"</span> section.</p>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="bg-gray-50 px-6 py-4 flex justify-end gap-3">
        <button (click)="closeFeeModal()" 
                class="px-6 py-2.5 bg-[#F59E0B] hover:bg-[#D97706] text-white font-bold rounded-lg shadow-sm transition-all active:scale-95">
          Got it!
        </button>
      </div>
    </div>
  </div>

  <!-- CV Format Detail Modal - WMA-MIS Style -->
  <div *ngIf="showDetailsModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4 overflow-y-auto print:p-0 print:bg-white">
    <div *ngIf="!loadingDetails && selectedApplicationDetails" class="bg-white w-full max-w-5xl my-auto shadow-2xl print:shadow-none print:max-w-none cv-container">
        
        <!-- Action Bar (No Print) -->
        <div class="action-bar print:hidden">
            <button (click)="closeDetailsModal()" class="back-link">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                </svg>
                Back to List
            </button>
            <div>
                <button (click)="printApplication()" class="btn btn-sm btn-outline-success">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 inline mr-1">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0110.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0l.229 2.523a1.125 1.125 0 01-1.12 1.227H7.231c-.41 0-.75-.336-.75-.75V18m0 0H3.375a1.125 1.125 0 01-1.125-1.125V9.375c0-.621.504-1.125 1.125-1.125H3.375c-.621 0-.504-1.125 1.125-1.125h14.25c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h.375m-6-15v2.25M6.75 6.75h.75m10.5 0h.75" />
                    </svg>
                    Print / Download PDF
                </button>
            </div>
        </div>

        <!-- Header -->
        <div class="cv-header">
            <h1>{{ (selectedApplicationDetails.personal_info.first_name + ' ' + (selectedApplicationDetails.personal_info.middle_name || '') + ' ' + selectedApplicationDetails.personal_info.last_name).toUpperCase() }}</h1>
            <div class="header-info">
                <div class="header-info-item">
                    <div class="header-info-label">License Number</div>
                    <div class="header-info-value">{{ selectedApplicationDetails.application_info.control_number || 'Pending' }}</div>
                </div>
                <div class="header-info-item">
                    <div class="header-info-label">Application Type</div>
                    <div class="header-info-value">{{ selectedApplicationDetails.application_info.type || 'New' }}</div>
                </div>
                <div class="header-info-item">
                    <div class="header-info-label">Status</div>
                    <div class="header-info-value">{{ selectedApplicationDetails.application_info.status || 'Pending' }}</div>
                </div>
            </div>
        </div>
        
        <!-- Content Sections -->
        <div class="cv-content">
            <!-- Personal Information -->
            <div class="cv-section">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    Personal Information
                </h2>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Full Name</div>
                        <div class="info-value">{{ selectedApplicationDetails.personal_info.first_name }} {{ selectedApplicationDetails.personal_info.middle_name }} {{ selectedApplicationDetails.personal_info.last_name }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Nationality</div>
                        <div class="info-value">{{ selectedApplicationDetails.personal_info.nationality || 'N/A' }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Email</div>
                        <div class="info-value">{{ selectedApplicationDetails.personal_info.email || 'N/A' }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Phone Number</div>
                        <div class="info-value">{{ selectedApplicationDetails.personal_info.phone || 'N/A' }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Region</div>
                        <div class="info-value">{{ selectedApplicationDetails.personal_info.region || 'N/A' }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">District</div>
                        <div class="info-value">{{ selectedApplicationDetails.personal_info.district || 'N/A' }}</div>
                    </div>
                </div>
            </div>

            <!-- Required Attachments -->
            <div *ngIf="selectedApplicationDetails.attachments?.length" class="cv-section">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                    Required Attachments
                </h2>
                <ul class="doc-list">
                    <li *ngFor="let doc of selectedApplicationDetails.attachments" class="doc-item">
                        <div class="doc-name">
                            <svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                            {{ doc.document_type || 'Document' }}
                        </div>
                        <span class="doc-status" [ngClass]="'status-' + (doc.status || 'pending').toLowerCase()">
                            {{ doc.status || 'Pending' }}
                        </span>
                    </li>
                </ul>
            </div>

            <!-- License Details -->
            <div *ngIf="selectedApplicationDetails.application_info.licenses?.length" class="cv-section">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24"><path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/></svg>
                    License Details
                </h2>
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>License Type</th>
                            <th>Application Fee</th>
                            <th>License Fee</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of selectedApplicationDetails.application_info.licenses; let i = index">
                            <td>{{ i + 1 }}</td>
                            <td>{{ item.license_type || 'N/A' }}</td>
                            <td>TZS {{ (item.application_fee || 0) | number:'1.2-2' }}</td>
                            <td>TZS {{ (item.fee || 0) | number:'1.2-2' }}</td>
                            <td><strong>TZS {{ ((item.fee || 0) + (item.application_fee || 0)) | number:'1.2-2' }}</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Tools & Qualifications -->
            <div *ngIf="selectedApplicationDetails.tools?.length || selectedApplicationDetails.qualifications?.length || selectedApplicationDetails.experiences?.length" class="cv-section">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>
                    Tools & Qualifications
                </h2>
                <div class="qual-grid">
                    <div *ngIf="selectedApplicationDetails.tools?.length" class="qual-card">
                        <h4>Tools & Equipment</h4>
                        <ul class="qual-list">
                            <li *ngFor="let tool of selectedApplicationDetails.tools">{{ tool.name || tool }}</li>
                        </ul>
                    </div>
                    <div *ngIf="selectedApplicationDetails.qualifications?.length" class="qual-card">
                        <h4>Technical Qualifications</h4>
                        <ul class="qual-list">
                            <li *ngFor="let qual of selectedApplicationDetails.qualifications">{{ qual.educationLevel || qual.institution || qual }}</li>
                        </ul>
                    </div>
                    <div *ngIf="selectedApplicationDetails.experiences?.length" class="qual-card">
                        <h4>Work Experience</h4>
                        <ul class="qual-list">
                            <li *ngFor="let exp of selectedApplicationDetails.experiences">{{ exp.organization || exp.company }} - {{ exp.position }}</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Loading State -->
    <div *ngIf="loadingDetails" class="bg-white p-12 rounded-lg text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"></div>
        <p class="mt-4 text-gray-600">Loading application details...</p>
    </div>
  </div>

</div>

<!-- WMA-MIS CV Styles -->
<style>
.cv-container {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: white;
    border-radius: 8px;
    overflow: hidden;
}

.cv-header {
    background: linear-gradient(135deg, #2c5f2d 0%, #1e4620 100%);
    color: white;
    padding: 30px 40px;
}

.cv-header h1 {
    font-size: 24px;
    margin-bottom: 10px;
    font-weight: bold;
}

.header-info {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-top: 20px;
    font-size: 13px;
}

.header-info-item {
    background: rgba(255,255,255,0.1);
    padding: 10px;
    border-radius: 5px;
}

.header-info-label {
    font-size: 10px;
    text-transform: uppercase;
    opacity: 0.8;
    margin-bottom: 3px;
}

.header-info-value {
    font-weight: 500;
}

.cv-content {
    padding: 40px;
}

.cv-section {
    margin-bottom: 35px;
}

.section-title {
    font-size: 18px;
    font-weight: 600;
    color: #2c5f2d;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid #2c5f2d;
    display: flex;
    align-items: center;
    gap: 10px;
}

.section-title svg {
    width: 20px;
    height: 20px;
    fill: #2c5f2d;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}

.info-item {
    padding: 15px;
    background: #f8f9fa;
    border-radius: 5px;
    border-left: 3px solid #2c5f2d;
}

.info-label {
    font-size: 11px;
    color: #666;
    text-transform: uppercase;
    margin-bottom: 5px;
    font-weight: 600;
}

.info-value {
    font-size: 14px;
    color: #1a1a1a;
    font-weight: 500;
}

.doc-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.doc-item {
    padding: 12px;
    background: #f8f9fa;
    border-radius: 5px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.doc-item svg {
    width: 16px;
    height: 16px;
    fill: #2c5f2d;
}

.doc-name {
    font-size: 14px;
    color: #1a1a1a;
    display: flex;
    align-items: center;
    gap: 10px;
}

.doc-status {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: bold;
}

.status-uploaded, .status-approved {
    background: #d4edda;
    color: #155724;
}

.status-pending {
    background: #fff3cd;
    color: #856404;
}

.status-returned {
    background: #f8d7da;
    color: #721c24;
}

.cv-container table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}

.cv-container table th {
    background: #f5f5f5;
    padding: 12px;
    text-align: left;
    font-size: 12px;
    font-weight: 600;
    color: #555;
    border: 1px solid #ddd;
}

.cv-container table td {
    padding: 12px;
    font-size: 13px;
    border: 1px solid #ddd;
    color: #333;
}

.cv-container table tr:hover {
    background: #fafafa;
}

.qual-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
}

.qual-card {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    border-left: 3px solid #2c5f2d;
}

.qual-card h4 {
    font-size: 13px;
    color: #2c5f2d;
    margin-bottom: 10px;
    text-transform: uppercase;
    font-weight: 600;
}

.qual-list {
    list-style: none;
    padding: 0;
}

.qual-list li {
    padding: 5px 0;
    font-size: 13px;
    color: #555;
}

.qual-list li:before {
    content: "•";
    color: #2c5f2d;
    font-weight: bold;
    margin-right: 8px;
}

.action-bar {
    background: white;
    padding: 15px 40px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.back-link {
    color: #666;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 5px;
    font-weight: 500;
    font-size: 14px;
    background: none;
    border: none;
    cursor: pointer;
}

.back-link:hover {
    color: #2c5f2d;
}

.btn {
    padding: 8px 16px;
    border-radius: 4px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-sm {
    padding: 6px 12px;
    font-size: 13px;
}

.btn-outline-success {
    background: white;
    color: #2c5f2d;
    border: 1px solid #2c5f2d;
}

.btn-outline-success:hover {
    background: #2c5f2d;
    color: white;
}

@media print {
    .action-bar, .print\:hidden {
        display: none !important;
    }
    
    .cv-container {
        box-shadow: none;
        border-radius: 0;
    }
    
    body {
        background: white;
    }
}
</style>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0110.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0l.229 2.523a1.125 1.125 0 01-1.12 1.227H7.231c-.41 0-.75-.336-.75-.75V18m0 0H3.375a1.125 1.125 0 01-1.125-1.125V9.375c0-.621.504-1.125 1.125-1.125H3.375c-.621 0-.504-1.125 1.125-1.125h14.25c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h.375m-6-15v2.25M6.75 6.75h.75m10.5 0h.75" />
                    </svg>
                    Print / Save PDF
                </button>
                <button (click)="closeDetailsModal()" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm font-medium">
                    Close
                </button>
            </div>
        </div>

        <!-- Printable Content -->
        <div class="p-8 lg:p-12 print:p-0 print:text-black">
            
            <!-- Header -->
            <div class="text-center mb-8 border-b-2 border-black pb-4">
                <!-- <img src="assets/images/logo.png" alt="Coat of Arms" class="h-20 mx-auto mb-3 grayscale opacity-90 hidden"> -->
                <h1 class="text-2xl font-black uppercase tracking-wider mb-1">The United Republic of Tanzania</h1>
                <h2 class="text-xl font-bold uppercase tracking-wide text-gray-800 mb-1">Ministry of Industry and Trade</h2>
                <h3 class="text-lg font-bold uppercase text-gray-700">Weights and Measures Agency (WMA)</h3>
            </div>

            <div class="flex justify-between items-start mb-8 gap-8">
                <div>
                    <h4 class="text-xl font-bold uppercase mb-4 decoration-2 underline underline-offset-4">Application for License</h4>
                    <div class="grid grid-cols-[140px_1fr] gap-y-2 text-sm">
                        <span class="font-bold">Control Number:</span>
                        <span class="font-mono text-base">{{ selectedApplicationDetails.application_info.control_number || 'N/A' }}</span>
                        
                        <span class="font-bold">Date:</span>
                        <span>{{ selectedApplicationDetails.application_info.date | date:'mediumDate' }}</span>

                        <span class="font-bold">License Type:</span>
                        <span>
                            <span *ngFor="let l of selectedApplicationDetails.application_info.licenses; let last=last">{{l.license_type}}{{!last ? ', ' : ''}}</span>
                        </span>
                    </div>
                </div>
                
                <!-- Photo Box -->
                <div class="w-32 h-40 border-2 border-gray-300 bg-gray-50 flex items-center justify-center text-xs text-center text-gray-400 p-2">
                    PASSPORT SIZE PHOTO
                </div>
            </div>

            <!-- Sections -->
            <div class="space-y-8">
                
                <!-- 1. Personal Particulars -->
                <div>
                    <h5 class="font-bold uppercase border-b border-gray-400 mb-3 pb-1 text-sm bg-gray-100 pl-2">1. Personal Particulars</h5>
                    <div class="grid grid-cols-2 gap-x-8 gap-y-3 text-sm px-2">
                        <div class="grid grid-cols-[120px_1fr]">
                            <span class="font-semibold text-gray-600">Full Name:</span>
                            <span class="font-bold uppercase">{{ selectedApplicationDetails.personal_info.first_name }} {{ selectedApplicationDetails.personal_info.middle_name }} {{ selectedApplicationDetails.personal_info.last_name }}</span>
                        </div>
                        <div class="grid grid-cols-[120px_1fr]">
                            <span class="font-semibold text-gray-600">Nationality:</span>
                            <span>{{ selectedApplicationDetails.personal_info.nationality }}</span>
                        </div>
                        <div class="grid grid-cols-[120px_1fr]">
                            <span class="font-semibold text-gray-600">Phone:</span>
                            <span>{{ selectedApplicationDetails.personal_info.phone }}</span>
                        </div>
                        <div class="grid grid-cols-[120px_1fr]">
                            <span class="font-semibold text-gray-600">Email:</span>
                            <span>{{ selectedApplicationDetails.personal_info.email }}</span>
                        </div>
                        <div class="grid grid-cols-[120px_1fr] col-span-2">
                            <span class="font-semibold text-gray-600">Address:</span>
                            <span>{{ selectedApplicationDetails.personal_info.address }}</span>
                        </div>
                         <div class="grid grid-cols-[120px_1fr]">
                            <span class="font-semibold text-gray-600">Region:</span>
                            <span>{{ selectedApplicationDetails.personal_info.region }}</span>
                        </div>
                        <div class="grid grid-cols-[120px_1fr]">
                            <span class="font-semibold text-gray-600">District:</span>
                            <span>{{ selectedApplicationDetails.personal_info.district }}</span>
                        </div>
                    </div>
                </div>

                <!-- 2. Education -->
                <div *ngIf="selectedApplicationDetails.qualifications?.length">
                    <h5 class="font-bold uppercase border-b border-gray-400 mb-3 pb-1 text-sm bg-gray-100 pl-2">2. Educational Qualifications</h5>
                    <table class="w-full text-sm border-collapse border border-gray-300">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="border border-gray-300 px-3 py-2 text-left">Institution</th>
                                <th class="border border-gray-300 px-3 py-2 text-left">Award/Degree</th>
                                <th class="border border-gray-300 px-3 py-2 text-center w-24">Year</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let q of selectedApplicationDetails.qualifications">
                                <td class="border border-gray-300 px-3 py-2">{{ q.institution }}</td>
                                <td class="border border-gray-300 px-3 py-2">{{ q.educationLevel }}</td>
                                <td class="border border-gray-300 px-3 py-2 text-center">{{ q.yearCompleted }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 3. Experience -->
                <div *ngIf="selectedApplicationDetails.experiences?.length">
                    <h5 class="font-bold uppercase border-b border-gray-400 mb-3 pb-1 text-sm bg-gray-100 pl-2">3. Professional Experience</h5>
                    <table class="w-full text-sm border-collapse border border-gray-300">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="border border-gray-300 px-3 py-2 text-left">Organization</th>
                                <th class="border border-gray-300 px-3 py-2 text-left">Position</th>
                                <th class="border border-gray-300 px-3 py-2 text-center">Duration</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let e of selectedApplicationDetails.experiences">
                                <td class="border border-gray-300 px-3 py-2">{{ e.organization }}</td>
                                <td class="border border-gray-300 px-3 py-2">{{ e.position }}</td>
                                <td class="border border-gray-300 px-3 py-2 text-center">{{ e.startDate | date:'MMM y' }} - {{ e.endDate | date:'MMM y' }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                 <!-- 4. Tools -->
                <div *ngIf="selectedApplicationDetails.tools?.length">
                    <h5 class="font-bold uppercase border-b border-gray-400 mb-3 pb-1 text-sm bg-gray-100 pl-2">4. Tools & Equipment</h5>
                    <table class="w-full text-sm border-collapse border border-gray-300">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="border border-gray-300 px-3 py-2 text-left">Tool Name</th>
                                <th class="border border-gray-300 px-3 py-2 text-left">Model/Type</th>
                                <th class="border border-gray-300 px-3 py-2 text-center w-24">Quantity</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let t of selectedApplicationDetails.tools">
                                <td class="border border-gray-300 px-3 py-2">{{ t.name }}</td>
                                <td class="border border-gray-300 px-3 py-2">{{ t.model }}</td>
                                <td class="border border-gray-300 px-3 py-2 text-center">{{ t.quantity || 1 }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 5. Attachments -->
                <div *ngIf="selectedApplicationDetails.attachments?.length">
                    <h5 class="font-bold uppercase border-b border-gray-400 mb-3 pb-1 text-sm bg-gray-100 pl-2">5. Attachments</h5>
                     <ul class="list-disc leading-relaxed text-sm pl-8">
                        <li *ngFor="let doc of selectedApplicationDetails.attachments">
                            <span class="font-semibold text-gray-700">{{ doc.document_type }}: </span> 
                            <span class="text-gray-500">{{ doc.original_name }}</span>
                        </li>
                    </ul>
                </div>
                
                 <!-- Declaration -->
                <div class="mt-12 pt-8 border-t border-gray-300">
                    <p class="text-xs text-gray-500 italic mb-4">
                        I hereby declare that the information provided in this application is true and correct to the best of my knowledge. I understand that any false statement may result in the rejection of this application or revocation of license.
                    </p>
                    <div class="grid grid-cols-2 gap-12 mt-8">
                         <div>
                            <div class="border-b border-black mb-1"></div>
                            <div class="text-xs font-bold uppercase">Applicant Signature</div>
                         </div>
                         <div>
                            <div class="border-b border-black mb-1"></div>
                            <div class="text-xs font-bold uppercase">Date</div>
                         </div>
                    </div>
                </div>

            </div>
            </div>
        </div>
    </div>
  </div>

</div>

<!-- WMA-MIS CV Styles -->
<style>
