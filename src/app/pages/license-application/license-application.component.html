<div class="p-6 bg-gray-50 min-h-screen font-sans">
  
  <!-- Header -->
  <div class="mb-8 flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold text-gray-800 mb-1">License Application</h1>
      <p class="text-gray-500 text-sm">Apply for a new license or renew an existing one.</p>
    </div>
    
    <!-- Test Button for Interview Modal (Remove in production) -->
    <button (click)="openInterviewModal(mockInterview)" 
            class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg shadow-sm transition-all flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
      View Result (Test)
    </button>
  </div>

  <div class="space-y-8">

    <!-- Card 1: Personal Information -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden border-t-4 border-t-[#e79a3f]">
      <div class="bg-orange-50 px-6 py-4 border-b border-orange-100 flex justify-between items-center">
        <div>
          <h2 class="text-lg font-bold text-gray-800">Personal Information</h2>
          <p class="text-xs text-gray-500">This information has been pre-filled from your registration data.</p>
        </div>


      </div>
      <div class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        
        <!-- NIDA Number -->
        <div class="relative">
          <input type="text" [value]="personalInfo.identity_number || personalInfo.identityNumber || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            NIDA Number
          </label>
        </div>

        <!-- First Name -->
        <div class="relative">
          <input type="text" [value]="personalInfo.first_name || personalInfo.firstName || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            First Name
          </label>
        </div>

        <!-- Middle Name -->
        <div class="relative">
          <input type="text" [value]="personalInfo.second_name || personalInfo.secondName || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Middle Name
          </label>
        </div>

        <!-- Last Name -->
        <div class="relative">
          <input type="text" [value]="personalInfo.last_name || personalInfo.lastName || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Last Name
          </label>
        </div>

        <!-- Gender -->
        <div class="relative">
          <input type="text" [value]="personalInfo.gender || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Gender
          </label>
        </div>

        <!-- Date of Birth -->
        <div class="relative">
          <input type="text" [value]="personalInfo.dob || personalInfo.dateOfBirth || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Date of Birth
          </label>
        </div>

        <!-- Email -->
        <div class="relative">
          <input type="text" [value]="personalInfo.email || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Email
          </label>
        </div>

        <!-- Phone -->
        <div class="relative">
          <input type="text" [value]="personalInfo.phone || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Phone
          </label>
        </div>

        <!-- Region -->
        <div class="relative">
          <input type="text" [value]="personalInfo.region || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Region
          </label>
        </div>

        <!-- District -->
        <div class="relative">
          <input type="text" [value]="personalInfo.district || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            District
          </label>
        </div>

        <!-- Street -->
        <div class="relative">
          <input type="text" [value]="personalInfo.street || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Street
          </label>
        </div>

        <!-- Citizenship Status -->
        <div class="relative">
          <div class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-5 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary flex items-center gap-3">
            <span class="text-2xl">{{ flag }}</span>
            <div class="flex flex-col leading-tight">
              <span class="font-medium text-gray-800">{{ citizenship }} - {{ personalInfo.nationality || 'Tanzania' }}</span>
            </div>
          </div>
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Citizenship Status
          </label>
        </div>
      </div>
    </div>

    <!-- Card 2: Company Details -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden border-t-4 border-t-[#e79a3f]">
      <div class="bg-orange-50 px-6 py-4 border-b border-orange-100 flex justify-between items-center">
        <div>
          <h2 class="text-lg font-bold text-gray-800">Company Information</h2>
          <p class="text-xs text-gray-500">This information has been pre-filled from your registration data.</p>
        </div>
        <button (click)="navigateToProfile()" class="flex items-center gap-2 px-4 py-2 rounded-md border border-stroke text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors bg-white">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
          </svg>
          Edit
        </button>
      </div>
      
      <div class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        
        <!-- Company Name -->
        <div class="relative">
          <input type="text" [value]="companyInfo.company_name || companyInfo.companyName || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Company Name
          </label>
        </div>

        <!-- Registration Number (BRELA) -->
        <div class="relative">
          <input type="text" [value]="companyInfo.brela_number || companyInfo.brelaNumber || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Registration Number (BRELA)
          </label>
        </div>

        <!-- Tax Number (TIN) -->
        <div class="relative">
          <input type="text" [value]="companyInfo.tin || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Tax Number (TIN)
          </label>
        </div>

        <!-- Company Email -->
        <div class="relative">
          <input type="text" [value]="companyInfo.company_email || companyInfo.companyEmail || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Company Email
          </label>
        </div>

        <!-- Company Phone -->
        <div class="relative">
          <input type="text" [value]="companyInfo.company_phone || companyInfo.companyPhone || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Company Phone
          </label>
        </div>

        <!-- Region -->
        <div class="relative">
          <input type="text" [value]="companyInfo.bus_region || companyInfo.region || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Region
          </label>
        </div>

        <!-- District -->
        <div class="relative">
          <input type="text" [value]="companyInfo.bus_district || companyInfo.district || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            District
          </label>
        </div>

        <!-- Town -->
        <div class="relative">
          <input type="text" [value]="companyInfo.bus_town || companyInfo.town || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Town
          </label>
        </div>

        <!-- Postal Code -->
        <div class="relative">
          <input type="text" [value]="companyInfo.postal_code || companyInfo.postalCode || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Postal Code
          </label>
        </div>

        <!-- Street/Village -->
        <div class="relative">
          <input type="text" [value]="companyInfo.bus_street || companyInfo.street || '-'" readonly
            class="peer w-full rounded-lg border border-stroke bg-transparent px-4 pt-6 pb-2 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" />
          <label class="absolute left-4 top-4 z-10 origin-[0] -translate-y-3 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 dark:text-gray-400">
            Street/Village
          </label>
        </div>

      </div>
    </div>

    <!-- Card: Application Type -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden border-t-4 border-t-[#e79a3f]">
      <div class="bg-orange-50 px-6 py-4 border-b border-orange-100">
        <h2 class="text-lg font-bold text-gray-800">Application Type</h2>
      </div>
      <div class="p-6">
        <div class="flex items-center gap-6 mb-6">
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="applicationType" [(ngModel)]="applicationType" value="New" (change)="updateRequiredDocuments()" class="w-5 h-5 text-[#e79a3f] focus:ring-[#e79a3f] accent-[#e79a3f] border-gray-300">
            <span class="text-gray-700 font-medium">New</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="applicationType" [(ngModel)]="applicationType" value="Renewal" (change)="updateRequiredDocuments()" class="w-5 h-5 text-[#e79a3f] focus:ring-[#e79a3f] accent-[#e79a3f] border-gray-300">
            <span class="text-gray-700 font-medium">Renewal</span>
          </label>
        </div>

        <div *ngIf="applicationType === 'New'" class="bg-orange-50/50 border-l-4 border-orange-200 p-4 rounded-r-md">
          <div class="flex gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-orange-500 flex-shrink-0">
              <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
            </svg>
            <div>
              <h3 class="font-bold text-gray-800 mb-2">New License Application</h3>
              <p class="text-sm text-gray-600 mb-2">You are applying for a new Weights and Measures License. To complete this process, you will be required to provide the following:</p>
              <ul class="list-disc list-inside text-sm text-gray-600 space-y-1 ml-1">
                <li>Submission of all mandatory personal and business documents</li>
                <li>Proof of required qualifications</li>
                <li>Payment of the application fee for Tanzanian citizens (TZS 50,000)</li>
                <li>Payment of the application fee for non-citizens (TZS 200,000)</li>
                <li>Completion of the verification process conducted by WMA officials</li>
              </ul>
              <p class="text-sm text-gray-600 mt-2 font-medium">Note: The license fee depends on the type of license you are applying for.</p>
              <p class="text-sm text-gray-600 mt-2">Processing time for new applications is typically 7–14 working days, starting after all submitted documents have been successfully verified.</p>
            </div>
          </div>
        </div>

        <div *ngIf="applicationType === 'Renewal'" class="bg-orange-50/50 border-l-4 border-orange-200 p-4 rounded-r-md">
          <div class="flex gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-orange-500 flex-shrink-0">
              <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
            </svg>
            <div>
              <h3 class="font-bold text-gray-800 mb-2">License Renewal</h3>
              <p class="text-sm text-gray-600 mb-2">You are applying to renew your Weights and Measures License. To complete this process, you will be required to provide the following:</p>
              <ul class="list-disc list-inside text-sm text-gray-600 space-y-1 ml-1">
                <li>Verification of your existing license number</li>
                <li>Submission of renewal-specific documentation</li>
                <li>Payment of the application fee for Tanzanian citizens (TZS 50,000)</li>
                <li>Payment of the application fee for non-citizens (TZS 200,000)</li>
                <li>Completion of the verification process conducted by WMA officials</li>
                <li>Brief review of past activities</li>
              </ul>
              <p class="text-sm text-gray-600 mt-2 font-medium">Note: The license fee depends on the type of license you are renewing.</p>
              <p class="text-sm text-gray-600 mt-2">Processing time for renewal applications is typically 7–14 working days, starting after all submitted documents have been successfully verified.</p>
            </div>
          </div>
        </div>

      </div>
    </div>









    <!-- Card 3: Required Attachments -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden border-t-4 border-t-[#e79a3f] border-b-4">
      <div class="bg-orange-50 px-6 py-4 border-b border-orange-100">
        <h2 class="text-lg font-bold text-gray-800">Required Attachments</h2>
        <p class="text-xs text-gray-500">This section contains all mandatory documents needed to complete your application.</p>
      </div>
      <div class="p-6">
        <p class="text-sm text-gray-600 mb-6">Each document displays its upload date, status, and available actions.</p>
        
        <!-- Removed invalid global file input -->
        
        <div class="overflow-x-auto">
          <table class="w-full text-left border-collapse">
            <thead>
              <tr class="border-b border-gray-200">
                <th class="py-3 px-4 text-sm font-semibold text-gray-700">Document Name</th>
                <th class="py-3 px-4 text-sm font-semibold text-gray-700">Date Uploaded</th>
                <th class="py-3 px-4 text-sm font-semibold text-gray-700">Status</th>
                <th class="py-3 px-4 text-sm font-semibold text-gray-700">Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let doc of requiredDocuments" 
                  [ngClass]="{
                    'border-b border-gray-100 hover:bg-gray-50': doc.status !== 'Returned' || doc.viewed,
                    'returned-document': doc.status === 'Returned' && !doc.viewed
                  }">
                <td class="py-3 px-4 text-sm text-gray-800">
                  <div class="flex items-center gap-2">
                    <!-- Red warning icon for unviewed returned documents -->
                    <svg *ngIf="doc.status === 'Returned' && !doc.viewed" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-red-600 pulse-animation">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                    </svg>
                    <span>{{ doc.name }}</span>
                  </div>
                  <div *ngIf="doc.status === 'Uploaded' && doc.fileName" class="text-xs text-gray-500 mt-1 flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                    </svg>
                    {{ doc.fileName }}
                  </div>
                  <div *ngIf="doc.status === 'Returned' && doc.rejectionReason" class="text-xs mt-2 p-2 rounded rejection-alert">
                    <span class="font-bold">Reason:</span> {{ doc.rejectionReason }}
                  </div>
                </td>
                <td class="py-3 px-4 text-sm text-gray-600">{{ doc.date }}</td>
                <td class="py-3 px-4">
                  <span [ngClass]="{
                    'bg-green-100 text-green-700': doc.status === 'Uploaded', 
                    'bg-blue-100 text-blue-700 font-semibold': doc.status === 'Resubmitted',
                    'bg-gray-100 text-gray-600': doc.status === 'Not Uploaded',
                    'returned-badge': doc.status === 'Returned'
                  }" 
                        class="px-3 py-1.5 rounded-full text-xs font-medium uppercase">
                    {{ doc.status === 'Resubmitted' ? 'Under Review' : doc.status }}
                  </span>
                </td>
                <td class="py-3 px-4">
                  <div class="flex items-center gap-2">
                    <button *ngIf="doc.status === 'Not Uploaded'" (click)="triggerFileUpload(doc)" class="p-1.5 rounded-lg bg-orange-50 text-orange-600 border border-orange-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-orange-100" title="Upload">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                      </svg>
                    </button>
                    <ng-container *ngIf="doc.status === 'Uploaded' || doc.status === 'Resubmitted'">
                      <button (click)="viewDocument(doc)" class="p-1.5 rounded-lg bg-blue-50 text-blue-600 border border-blue-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-blue-100" title="View">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                      </button>
                      <button *ngIf="!isApplicationSubmitted" (click)="triggerFileUpload(doc)" class="p-1.5 rounded-lg bg-green-50 text-green-600 border border-green-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-green-100" title="Edit">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                        </svg>
                      </button>
                      <button *ngIf="!isApplicationSubmitted" (click)="deleteDocument(doc)" class="p-1.5 rounded-lg bg-red-50 text-red-600 border border-red-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-red-100" title="Delete">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                        </svg>
                      </button>
                    </ng-container>

                    <!-- Returned Status: Show View and Edit buttons -->
                    <ng-container *ngIf="doc.status === 'Returned'">
                      <!-- View Button -->
                      <button (click)="viewDocument(doc)" class="p-1.5 rounded-lg bg-blue-50 text-blue-600 border border-blue-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-blue-100" title="View">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                      </button>
                      
                      <!-- Edit/Re-upload Button (Always visible for returned documents) -->
                      <button (click)="triggerFileUpload(doc)" class="p-1.5 rounded-lg bg-green-50 text-green-600 border border-green-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-green-100" title="Re-upload">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                        </svg>
                      </button>
                    </ng-container>
                    <!-- Hidden File Input -->
                    <input type="file" [id]="'fileInput-' + doc.id" class="hidden" (change)="onFileSelected($event, doc.id)" accept="application/pdf">
                  </div>
                  <div *ngIf="doc.status === 'Returned' && doc.rejectionReason" class="text-xs text-red-600 mt-1 font-medium bg-red-50 p-1 rounded">
                    Reason: {{ doc.rejectionReason }}
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>

    <!-- Card 4: Qualification Documents -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden border-t-4 border-t-[#e79a3f] border-b-4">
      <div class="bg-orange-50 px-6 py-4 border-b border-orange-100">
        <h2 class="text-lg font-bold text-gray-800">Qualification Documents</h2>
        <p class="text-xs text-gray-500">Please upload any relevant qualification certificates.</p>
      </div>
      <div class="p-6">
        <p class="text-sm text-gray-600 mb-6">Each document displays its upload date, status, and available actions.</p>
        
        <div class="overflow-x-auto">
          <table class="w-full text-left border-collapse">
            <thead>
              <tr class="border-b border-gray-200">
                <th class="py-3 px-4 text-sm font-semibold text-gray-700">Document Name</th>
                <th class="py-3 px-4 text-sm font-semibold text-gray-700">Date Uploaded</th>
                <th class="py-3 px-4 text-sm font-semibold text-gray-700">Status</th>
                <th class="py-3 px-4 text-sm font-semibold text-gray-700">Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let doc of qualificationDocuments" 
                  [ngClass]="{
                    'border-b border-gray-100 hover:bg-gray-50': doc.status !== 'Returned' || doc.viewed,
                    'returned-document': doc.status === 'Returned' && !doc.viewed
                  }">
                <td class="py-3 px-4 text-sm text-gray-800">
                  <div class="flex items-center gap-2">
                    <!-- Red warning icon for unviewed returned documents -->
                    <svg *ngIf="doc.status === 'Returned' && !doc.viewed" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-red-600 pulse-animation">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                    </svg>
                    <span>{{ doc.name }}</span>
                  </div>
                  <div *ngIf="doc.status === 'Uploaded' && doc.fileName" class="text-xs text-gray-500 mt-1 flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                    </svg>
                    {{ doc.fileName }}
                  </div>
                  <div *ngIf="doc.status === 'Returned' && doc.rejectionReason" class="text-xs mt-2 p-2 rounded rejection-alert">
                    <span class="font-bold">Reason:</span> {{ doc.rejectionReason }}
                  </div>
                </td>
                <td class="py-3 px-4 text-sm text-gray-600">{{ doc.date }}</td>
                <td class="py-3 px-4">
                  <span [ngClass]="{
                    'bg-green-100 text-green-700': doc.status === 'Uploaded', 
                    'bg-blue-100 text-blue-700 font-semibold': doc.status === 'Resubmitted',
                    'bg-gray-100 text-gray-600': doc.status === 'Not Uploaded',
                    'returned-badge': doc.status === 'Returned'
                  }" 
                        class="px-3 py-1.5 rounded-full text-xs font-medium uppercase">
                    {{ doc.status === 'Resubmitted' ? 'Under Review' : doc.status }}
                  </span>
                </td>
                <td class="py-3 px-4">
                  <div class="flex items-center gap-2">
                    <!-- BEFORE SUBMISSION: Upload button for all not-uploaded docs -->
                    <button *ngIf="!isApplicationSubmitted && doc.status === 'Not Uploaded'" 
                            (click)="triggerFileUpload(doc)" 
                            class="p-1.5 rounded-lg bg-orange-50 text-orange-600 border border-orange-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-orange-100" 
                            title="Upload">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                      </svg>
                    </button>

                    <!-- BEFORE SUBMISSION: View, Edit, Delete for uploaded docs -->
                    <ng-container *ngIf="!isApplicationSubmitted && (doc.status === 'Uploaded' || doc.status === 'Resubmitted')">
                      <!-- View Button -->
                      <button (click)="viewDocument(doc)" 
                              class="p-1.5 rounded-lg bg-blue-50 text-blue-600 border border-blue-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-blue-100" 
                              title="View">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                      </button>
                      
                      <!-- Edit Button -->
                      <button (click)="triggerFileUpload(doc)" 
                              class="p-1.5 rounded-lg bg-green-50 text-green-600 border border-green-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-green-100" 
                              title="Edit">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                        </svg>
                      </button>
                      
                      <!-- Delete Button -->
                      <button (click)="deleteDocument(doc)" 
                              class="p-1.5 rounded-lg bg-red-50 text-red-600 border border-red-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-red-100" 
                              title="Delete">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                        </svg>
                      </button>
                    </ng-container>

                    <!-- AFTER SUBMISSION - UPLOADED DOCS: Only View button (read-only) -->
                    <ng-container *ngIf="isApplicationSubmitted && (doc.status === 'Uploaded' || doc.status === 'Resubmitted')">
                      <button (click)="viewDocument(doc)" 
                              class="p-1.5 rounded-lg bg-blue-50 text-blue-600 border border-blue-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-blue-100" 
                              title="View">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                      </button>
                    </ng-container>

                    <!-- AFTER SUBMISSION - MISSING DOCS: Save button to upload -->
                    <ng-container *ngIf="isApplicationSubmitted && doc.status === 'Not Uploaded'">
                      <button (click)="triggerFileUpload(doc)" 
                              class="p-1.5 rounded-lg bg-purple-50 text-purple-600 border border-purple-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-purple-100" 
                              title="Upload Missing Document">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                        </svg>
                      </button>
                    </ng-container>

                    <!-- PENDING STATE: View, Edit and Save buttons after file selection -->
                    <ng-container *ngIf="doc.status === 'Pending'">
                      <!-- View Button (if there was a previous upload) -->
                      <button *ngIf="doc.dbId" 
                              (click)="viewDocument(doc)" 
                              class="p-1.5 rounded-lg bg-blue-50 text-blue-600 border border-blue-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-blue-100" 
                              title="View Previous Document">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                      </button>
                      
                      <!-- Edit Button (to change the selected file) -->
                      <button (click)="triggerFileUpload(doc)" 
                              class="p-1.5 rounded-lg bg-green-50 text-green-600 border border-green-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-green-100" 
                              title="Edit (Change File)">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                        </svg>
                      </button>
                      
                      <!-- Save Button (to upload the selected file) -->
                      <button (click)="saveDocument(doc)" 
                              class="p-1.5 rounded-lg bg-purple-50 text-purple-600 border border-purple-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-purple-100" 
                              title="Save (Upload Document)">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0111.186 0z" />
                        </svg>
                      </button>
                    </ng-container>

                    <!-- RETURNED DOCS: View + Edit buttons (regardless of submission status) -->
                    <ng-container *ngIf="doc.status === 'Returned'">
                      <!-- View Button -->
                      <button (click)="viewDocument(doc)" 
                              class="p-1.5 rounded-lg bg-blue-50 text-blue-600 border border-blue-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-blue-100" 
                              title="View">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                      </button>
                      
                      <!-- Edit/Re-upload Button -->
                      <button (click)="triggerFileUpload(doc)" 
                              class="p-1.5 rounded-lg bg-green-50 text-green-600 border border-green-200 border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:bg-green-100" 
                              title="Edit (Re-upload)">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                        </svg>
                      </button>
                    </ng-container>

                    <!-- Hidden File Input -->
                    <input type="file" [id]="'fileInput-' + doc.id" class="hidden" (change)="onFileSelected($event, doc.id)" accept="application/pdf">
                  </div>
                  <div *ngIf="doc.status === 'Returned' && doc.rejectionReason" class="text-xs text-red-600 mt-1 font-medium bg-red-50 p-1 rounded">
                    Reason: {{ doc.rejectionReason }}
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>


    <!-- Card 4: License Type Selection -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden border-t-4 border-t-[#e79a3f] border-b-4">
      <div class="bg-orange-50 px-6 py-4 border-b border-orange-100">
        <h2 class="text-lg font-bold text-gray-800">License Type Selection</h2>
        <p class="text-xs text-gray-500">Select the license class types you would like to apply for.</p>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div *ngFor="let license of licenseTypes" 
               [class]="'border rounded-lg p-4 transition-all ' + (license.selected ? 'border-[#F59E0B] bg-orange-50 ring-1 ring-[#F59E0B]' : (license.submitted ? 'border-green-200 bg-green-50' : 'border-gray-200')) + (!license.submitted ? ' cursor-pointer hover:border-orange-200' : '')"
               (click)="toggleLicense(license)">
            <div class="flex items-start justify-between mb-2">
              <h4 class="font-bold text-gray-800">{{ license.name }}</h4>
              
              <ng-container *ngIf="!license.submitted">
                <input type="checkbox" [checked]="license.selected" class="h-5 w-5 text-[#F59E0B] rounded border-gray-300 focus:ring-[#F59E0B] pointer-events-none">
              </ng-container>
              
              <ng-container *ngIf="license.submitted">
                <div class="bg-green-100 text-green-600 rounded-full p-1">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                  </svg>
                </div>
              </ng-container>

            </div>
            <p class="text-sm text-gray-600 mb-3 min-h-[40px]">{{ license.description }}</p>
            
            <!-- Instruments Selection -->
            <div *ngIf="license.availableInstruments && license.availableInstruments.length > 0" class="mb-3" (click)="$event.stopPropagation()">
                <div class="text-xs font-bold text-gray-500 mb-1 uppercase tracking-wide border-b pb-1">Selected Instruments</div>
                 
                <!-- Criteria Hint -->
                <div *ngIf="license.criteria && (license.criteria.min || license.criteria.max)" class="text-[11px] text-blue-600 mb-2 font-medium">
                     <span *ngIf="license.criteria.min">Min: {{license.criteria.min}}</span>
                     <span *ngIf="license.criteria.max" class="ml-1">Max: {{license.criteria.max}}</span>
                </div>

                <div class="space-y-1.5 max-h-40 overflow-y-auto pr-1">
                    <label *ngFor="let inst of license.availableInstruments" class="flex items-start space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded transition-colors select-none">
                        <input type="checkbox" 
                               [checked]="license.userSelectedInstruments?.includes(inst)"
                               (change)="toggleInstrument(license, inst, $event)"
                               [disabled]="license.submitted"
                               class="mt-0.5 h-4 w-4 text-[#e79a3f] border-gray-300 rounded focus:ring-[#e79a3f]">
                        <span class="text-sm text-gray-700 leading-tight">{{ inst }}</span>
                    </label>
                </div>
                
                 <!-- Validation Feedback -->
                 <div *ngIf="license.selected && !getCriteriaStatus(license).valid" class="mt-2 text-xs text-red-600 font-bold flex items-center animate-pulse">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" viewBox="0 0 20 20" fill="currentColor">
                       <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                     </svg>
                     {{ getCriteriaStatus(license).message }}
                 </div>
            </div>

            <div class="font-bold text-[#F59E0B] mt-2 border-t pt-2">TZS {{ license.fee | number }}</div>
          </div>
        </div>

      </div>
    </div>

    <!-- Card 5: Application Fees -->
    <div *ngIf="selectedLicenses.length > 0" class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden border-t-4 border-t-[#e79a3f]">
      <div class="bg-orange-50 px-6 py-4 border-b border-orange-100">
        <h2 class="text-lg font-bold text-gray-800">Application fees</h2>
      </div>
      <div class="p-0">
        <div class="px-6 py-4 space-y-3">
          <div *ngFor="let license of selectedLicenses" class="flex justify-between items-center text-sm text-gray-700 border-b border-gray-50 pb-2 last:border-0 last:pb-0">
            <span>{{ license.name }}:</span>
            <span class="font-medium">{{ applicationFee | number }} TZS</span>
          </div>
        </div>
        
        <div class="bg-[#FFF7ED] px-6 py-4 flex justify-between items-center">
          <span class="font-bold text-gray-800">Total Amount:</span>
          <span class="text-xl font-bold text-[#F59E0B]">TZS {{ totalAmount | number:'1.2-2' }}</span>
        </div>
      </div>
    </div>

    <!-- Card 5: Declaration -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden border-t-4 border-t-[#e79a3f]">
      <div class="bg-orange-50 px-6 py-4 border-b border-orange-100">
        <h2 class="text-lg font-bold text-gray-800">Declaration</h2>
      </div>
      <div class="p-6">
        <label class="flex items-start gap-3 cursor-pointer">
          <input type="checkbox" [(ngModel)]="declarationAccepted" class="mt-1 h-5 w-5 text-[#F59E0B] rounded border-gray-300 focus:ring-[#F59E0B]">
          <div class="text-sm text-gray-700">
            <p class="font-medium mb-1">I hereby declare that the information provided is true and correct.</p>
            <p class="text-gray-500">By checking this box, I declare that all the information provided in this application is true and accurate to the best of my knowledge. I understand that providing false information may result in application rejection or license revocation.</p>
          </div>
        </label>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="flex justify-end">
      <button 
        type="button"
        (click)="submitApplication()" 
        [disabled]="isSubmitting || !declarationAccepted || totalAmount === 0"
        class="bg-[#F59E0B] hover:bg-[#D97706] text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
        <span *ngIf="isSubmitting" class="animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full"></span>
        {{ isSubmitting ? 'Submitting...' : 'Submit Application' }}
      </button>
    </div>

  </div>



  <!-- PDF Preview Modal -->
  <!-- PDF Preview Modal -->
  <!-- PDF Preview Modal -->


<!-- Interview Result Modal -->
<div *ngIf="showInterviewModal" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
  <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
    
    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true" (click)="closeInterviewModal()"></div>

    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

    <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
      <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
        <div class="sm:flex sm:items-start">
          <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
            <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4 border-b pb-2">
              Interview Assessment Details
            </h3>
            
            <div class="space-y-4" *ngIf="selectedInterview">
                
                <!-- Status Badge -->
                <div class="flex justify-between items-center">
                    <span class="text-sm font-medium text-gray-500">Result</span>
                    <span class="px-3 py-1 rounded-full text-xs font-bold uppercase"
                        [ngClass]="{
                          'bg-green-100 text-green-700': selectedInterview.result === 'PASS',
                          'bg-red-100 text-red-700': selectedInterview.result === 'FAIL'
                        }">
                      {{ selectedInterview.result }}
                    </span>
                </div>

                <!-- Date -->
                <div class="flex justify-between items-center">
                    <span class="text-sm font-medium text-gray-500">Date</span>
                    <span class="text-sm text-gray-900">{{ selectedInterview.date | date:'medium' }}</span>
                </div>

                <!-- Panel -->
                <div class="flex justify-between items-start">
                    <span class="text-sm font-medium text-gray-500 whitespace-nowrap mr-4">Panel Members</span>
                    <span class="text-sm text-gray-900 text-right">{{ selectedInterview.panel || 'N/A' }}</span>
                </div>

                <!-- Scores Grid -->
                <div class="grid grid-cols-3 gap-3">
                    <div class="bg-gray-50 border border-gray-100 p-3 rounded-lg text-center">
                        <div class="text-[10px] uppercase font-bold text-gray-500 mb-1">Theory</div>
                         <div class="text-lg font-bold text-gray-800">{{ selectedInterview.theory !== undefined ? selectedInterview.theory : '-' }}</div>
                    </div>
                    <div class="bg-gray-50 border border-gray-100 p-3 rounded-lg text-center">
                        <div class="text-[10px] uppercase font-bold text-gray-500 mb-1">Practical</div>
                         <div class="text-lg font-bold text-gray-800">{{ selectedInterview.practical !== undefined ? selectedInterview.practical : '-' }}</div>
                    </div>
                    <div class="bg-orange-50 border border-orange-100 p-3 rounded-lg text-center">
                        <div class="text-[10px] uppercase font-bold text-orange-600 mb-1">Total</div>
                         <div class="text-lg font-bold text-orange-700">{{ selectedInterview.total !== undefined ? selectedInterview.total : '-' }}</div>
                    </div>
                </div>

                 <!-- Comments -->
                 <div class="bg-gray-50 p-3 rounded-md">
                    <h4 class="text-xs font-bold text-gray-500 uppercase mb-2">Comments</h4>
                    <p class="text-sm text-gray-800 whitespace-pre-line">{{ selectedInterview.comments || 'No comments provided.' }}</p>
                </div>

            </div>
          </div>
        </div>
      </div>
      <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
        <button type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-orange-600 text-base font-medium text-white hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:ml-3 sm:w-auto sm:text-sm" (click)="closeInterviewModal()">
          Close
        </button>
      </div>
    </div>
  </div>
</div>
</div>

<!-- Bill Modal -->
<app-modal [isOpen]="showBillModal" (close)="showBillModal = false; router.navigate(['/dashboard'])" className="max-w-4xl w-full m-4" [showCloseButton]="true">
    <!-- Bill Content -->
    <div class="p-8" id="billContent">
      <!-- Header -->
      <div class="flex justify-between items-start mb-8 border-b border-gray-200 pb-4">
        <img src="/images/logo/logo-icon.svg" alt="Coat of Arms" class="h-20">
        <div class="text-center">
          <h1 class="text-xl font-bold uppercase text-gray-900">The United Republic of Tanzania</h1>
          <h2 class="text-lg font-bold uppercase text-gray-800">Ministry of Industry and Trade</h2>
          <h3 class="text-lg font-bold uppercase text-gray-800">Weights and Measures Agency</h3>
          <p class="text-sm text-gray-600 mt-1">Government Bill</p>
        </div>
        <img src="/images/logo/wma-logo.jpg" alt="WMA Logo" class="h-20">
      </div>

      <!-- Bill Details -->
      <div class="grid grid-cols-2 gap-8 mb-8">
        <div class="space-y-2 text-sm">
          <div class="flex">
            <span class="w-40 font-medium text-gray-600">Control Number:</span>
            <span class="font-bold text-gray-900">{{ billData?.controlNumber }}</span>
          </div>
          <div class="flex">
            <span class="w-40 font-medium text-gray-600">Service Provider Code:</span>
            <span class="font-bold text-gray-900">SP419</span>
          </div>
          <div class="flex">
            <span class="w-40 font-medium text-gray-600">Payer:</span>
            <span class="font-bold text-gray-900 uppercase">{{ billData?.pyrName || personalInfo.firstName + ' ' + personalInfo.lastName }}</span>
          </div>
          <div class="flex">
            <span class="w-40 font-medium text-gray-600">Payer Phone:</span>
            <span class="font-bold text-gray-900">{{ billData?.pyrCellNum || personalInfo.phoneNumber }}</span>
          </div>
          <div class="flex">
            <span class="w-40 font-medium text-gray-600">Bill Description:</span>
            <span class="font-bold text-gray-900">{{ billData?.billDesc }}</span>
          </div>
        </div>
        <div class="flex justify-end">
          <!-- QR Code Placeholder -->
          <div class="border-2 border-gray-900 p-1">
             <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data={{billData?.controlNumber}}" alt="QR Code" class="h-32 w-32">
          </div>
        </div>
      </div>

      <!-- Items Table -->
      <table class="w-full mb-8 border-collapse">
        <thead>
          <tr class="border-b border-gray-200">
            <th class="text-left py-2 font-bold text-gray-700 w-10">#</th>
            <th class="text-left py-2 font-bold text-gray-700">Billed Item</th>
            <th class="text-right py-2 font-bold text-gray-700">Amount</th>
          </tr>
        </thead>
        <tbody>
          <!-- Assuming billData.items is available or we use selectedLicenses -->
          <tr *ngFor="let item of selectedLicenses; let i = index" class="border-b border-gray-100">
            <td class="py-2 text-gray-600">{{ i + 1 }}</td>
            <td class="py-2 text-gray-800">{{ item.name }}</td>
            <td class="py-2 text-right font-bold text-gray-900">Tsh {{ item.fee | number }}</td>
          </tr>
        </tbody>
      </table>

      <!-- Totals & Info -->
      <div class="grid grid-cols-2 gap-8 text-sm">
        <div class="space-y-3">
          <div class="flex">
            <span class="w-40 font-bold text-gray-700">Total Billed Amount:</span>
            <span class="font-bold text-gray-900">{{ billData?.amount | number }} (TZS)</span>
          </div>
          <div class="flex">
            <span class="w-40 font-medium text-gray-600">Amount In Words:</span>
            <span class="text-gray-800 capitalize">{{ billData?.amountInWords || 'One Hundred Thousand Tanzanian Shillings Only.' }}</span>
          </div>
          <div class="flex">
            <span class="w-40 font-bold text-gray-700">Expires On:</span>
            <span class="font-bold text-gray-900">{{ billData?.billExpiryDate | date:'dd MMM yyyy' }}</span>
          </div>
          <div class="flex">
            <span class="w-40 font-medium text-gray-600">Prepared By:</span>
            <span class="text-gray-800">Lilian Mwombeki</span>
          </div>
          <div class="flex">
            <span class="w-40 font-medium text-gray-600">Collection Center:</span>
            <span class="text-gray-800">Kinondoni Wakala Wa Vipimo</span>
          </div>
          <div class="flex">
            <span class="w-40 font-medium text-gray-600">Printed By:</span>
            <span class="font-bold text-gray-900">{{ personalInfo.firstName }} {{ personalInfo.lastName }}</span>
          </div>
          <div class="flex">
            <span class="w-40 font-medium text-gray-600">Printed On:</span>
            <span class="text-gray-800">{{ today | date:'dd MMM yyyy' }}</span>
          </div>
          <div class="flex">
            <span class="w-40 font-medium text-gray-600">Signature:</span>
            <span class="text-gray-800">.................................</span>
          </div>
        </div>
      </div>

      <!-- Payment Instructions -->
      <div class="mt-8 pt-6 border-t border-gray-200 grid grid-cols-2 gap-8 text-xs">
        <div>
          <h4 class="font-bold text-gray-900 mb-2">How to pay</h4>
          <ul class="list-disc pl-4 space-y-1 text-gray-700">
            <li>1 Via bank: visit any branch or bank agent of CRDB, NMB, reference number: <span class="font-bold">{{ billData?.controlNumber }}</span></li>
            <li>2 Via Mobile Network Operators (MNO):
              <ul class="list-disc pl-4 mt-1">
                <li>Enter respective USSD menu of MNO</li>
                <li>Select 4 (Make Payments)</li>
                <li>Select 5 (Government payments enter <span class="font-bold">{{ billData?.controlNumber }}</span> as reference number)</li>
              </ul>
            </li>
          </ul>
        </div>
        <div>
          <h4 class="font-bold text-gray-900 mb-2">Jinsi ya kulipa</h4>
          <ul class="list-disc pl-4 space-y-1 text-gray-700">
            <li>(Kupitia Benki: Fika tawi lolote au wakala wa benki ya CRDB, NMB, Namba ya kumbukumbu: <span class="font-bold">{{ billData?.controlNumber }}</span>)</li>
            <li>(Kupitia mitandao ya simu:
              <ul class="list-disc pl-4 mt-1">
                <li>Ingia kwenye menu ya mtandao husika</li>
                <li>Chagua 4 (Lipa bili)</li>
                <li>Chagua 5 (malipo ya serikali ingiza <span class="font-bold">{{ billData?.controlNumber }}</span> kama namba ya kumbukumbu)</li>
              </ul>
            </li>
          </ul>
        </div>
      </div>

      <!-- Footer -->
      <div class="mt-8 text-center text-xs text-gray-500">
        Weights And Measures Agency Copyright © {{ today | date:'yyyy' }} All Rights Reserved
      </div>
    </div>

    <!-- Actions -->
    <div class="bg-gray-50 px-8 py-4 rounded-b-lg flex justify-end gap-3">
      <button (click)="showBillModal = false; router.navigate(['/dashboard'])" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Close</button>
      <button class="px-4 py-2 bg-brand-500 text-white rounded hover:bg-brand-600 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
        </svg>
        Print
      </button>
    </div>
</app-modal>
