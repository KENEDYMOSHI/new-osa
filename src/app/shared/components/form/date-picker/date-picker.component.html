<div>
  @if (label) {
  <app-label [for]="id">{{ label }}</app-label>
  }
  <div class="relative">
    <input
      [id]="id"
      [value]="value"
      readonly
      (click)="openModal()"
      [placeholder]="placeholder"
      class="cursor-pointer h-11 w-full rounded-lg border appearance-none px-4 py-2.5 pl-10 text-sm shadow-theme-xs placeholder:text-gray-400 focus:outline-hidden focus:ring-3 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 bg-transparent text-gray-800 border-gray-300 focus:border-brand-300 focus:ring-brand-500/20 dark:border-gray-700 dark:focus:border-brand-800"
    />
    <span class="absolute text-gray-500 -translate-y-1/2 pointer-events-none left-3 top-1/2 dark:text-gray-400">
      <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" class="size-5"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2C8.41421 2 8.75 2.33579 8.75 2.75V3.75H15.25V2.75C15.25 2.33579 15.5858 2 16 2C16.4142 2 16.75 2.33579 16.75 2.75V3.75H18.5C19.7426 3.75 20.75 4.75736 20.75 6V9V19C20.75 20.2426 19.7426 21.25 18.5 21.25H5.5C4.25736 21.25 3.25 20.2426 3.25 19V9V6C3.25 4.75736 4.25736 3.75 5.5 3.75H7.25V2.75C7.25 2.33579 7.58579 2 8 2ZM8 5.25H5.5C5.08579 5.25 4.75 5.58579 4.75 6V8.25H19.25V6C19.25 5.58579 18.9142 5.25 18.5 5.25H16H8ZM19.25 9.75H4.75V19C4.75 19.4142 5.08579 19.75 5.5 19.75H18.5C18.9142 19.75 19.25 19.4142 19.25 19V9.75Z" fill="currentColor"></path></svg>
    </span>
  </div>

  <!-- Modal Backdrop -->
  <div *ngIf="showModal" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900/40 backdrop-blur-sm transition-opacity" (click)="closeModal()">
      <!-- Modal Content -->
      <div class="bg-white rounded-[24px] shadow-2xl w-[340px] overflow-hidden transform transition-all scale-100" (click)="$event.stopPropagation()">
          
          <!-- Header (Date Display) -->
          <div class="bg-violet-600 p-6 text-white">
              <div class="text-sm font-medium opacity-80 cursor-pointer hover:opacity-100 transition-opacity" (click)="toggleView()">
                  {{ currentYear }}
              </div>
              <div class="text-3xl font-bold mt-1 cursor-pointer hover:opacity-90 transition-opacity" (click)="view = 'calendar'">
                  {{ months[currentMonth] | slice:0:3 }}, {{ weekDays[newDate(currentYear, currentMonth, 1).getDay()] }}
              </div>
          </div>

          <!-- Calendar View -->
          <div *ngIf="view === 'calendar'" class="p-4">
              <div class="flex justify-between items-center mb-4 px-2">
                  <button (click)="prevMonth()" class="p-1.5 hover:bg-gray-100 rounded-full text-gray-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                  </button>
                  <span class="text-sm font-bold text-gray-800 tracking-wide">{{ months[currentMonth] }} {{ currentYear }}</span>
                  <button (click)="nextMonth()" class="p-1.5 hover:bg-gray-100 rounded-full text-gray-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                    </svg>
                  </button>
              </div>

              <!-- Week Days -->
              <div class="grid grid-cols-7 mb-2 text-center">
                  <div *ngFor="let day of weekDays" class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">
                      {{ day | slice:0:1 }}
                  </div>
              </div>

              <!-- Days Grid -->
              <div class="grid grid-cols-7 gap-y-1 gap-x-1">
                  <!-- Padding Days -->
                  <div *ngFor="let p of paddingDays" class="h-9"></div>
                  
                  <!-- Active Days -->
                  <button *ngFor="let day of daysInMonth" 
                          (click)="selectDate(day)"
                          class="h-9 w-9 mx-auto flex items-center justify-center text-sm font-medium rounded-full transition-all duration-200"
                          [class.bg-violet-600]="isSelected(day)"
                          [class.text-white]="isSelected(day)"
                          [class.shadow-md]="isSelected(day)"
                          [class.hover:bg-violet-50]="!isSelected(day)"
                          [class.text-gray-700]="!isSelected(day)">
                      {{ day }}
                  </button>
              </div>
          </div>

          <!-- Year Selection View -->
          <div *ngIf="view === 'year'" class="h-[320px] overflow-y-auto p-2">
              <div class="grid grid-cols-3 gap-2">
                  <button *ngFor="let year of years" 
                          (click)="selectYear(year)"
                          class="py-3 text-sm rounded-xl transition-colors hover:bg-violet-50"
                          [class.bg-violet-600]="year === currentYear"
                          [class.text-white]="year === currentYear"
                          [class.text-gray-700]="year !== currentYear">
                      {{ year }}
                  </button>
              </div>
          </div>

          <!-- Footer -->
          <div class="flex justify-end p-4 pt-2">
            <button (click)="closeModal()" class="px-4 py-2 text-sm text-violet-600 hover:bg-violet-50 font-bold rounded-lg transition-colors">CANCEL</button>
          </div>

      </div>
  </div>
</div>